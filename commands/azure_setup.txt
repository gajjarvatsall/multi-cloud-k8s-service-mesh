# Install Azure CLI (if not already installed)
brew install azure-cli

# Login to Azure
az login

# Set your subscription (replace with your subscription ID)
az account set --subscription "your-subscription-id"

# Create a resource group
az group create --name multi-cloud-rg --location eastus

# Verify resource group
az group list --output table

# Navigate to Azure terraform directory
cd terraform/azure

# Initialize Terraform
terraform init

# Plan the deployment
terraform plan

# Apply the configuration (this will take about 10-15 minutes)
terraform apply

# Get AKS credentials
az aks get-credentials --resource-group multi-cloud-rg --name multi-cloud-aks

# Verify connection to AKS
kubectl get nodes

# Switch between clusters (you should now have both AWS and Azure contexts)
kubectl config get-contexts

# Rename contexts for clarity
kubectl config rename-context multi-cloud-eks aws-eks
kubectl config rename-context multi-cloud-aks azure-aks

# Verify contexts
kubectl config get-contexts

# Switch to Azure context
kubectl config use-context azure-aks

# Install Istio on AKS
istioctl install --set values.defaultRevision=default -y

# Enable sidecar injection
kubectl create namespace apps
kubectl label namespace apps istio-injection=enabled

# Verify Istio installation
kubectl get pods -n istio-system


